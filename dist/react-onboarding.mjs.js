import{Children as t,createContext as e,createElement as r,Component as n}from"react";var s=function(){var t={};function e(e){t[e]||(t[e]={})}return{tree:t,setStep:e,setField:function(r,n){void 0===t[n]&&e(n),t[n][r]||(t[n][r]="")},setFieldValue:function(e,r,n){void 0!==t[r]&&void 0!==t[r][e]&&(t[r][e]=n)},getFieldValue:function(e,r){return void 0===t[r]||void 0===t[r][e]?"":t[r][e]}}}(),o="STEP",i="FIELD",p="END";function a(t,e){return t.type.__type!==i?t:Object.assign({},t,{key:t.props.name,props:Object.assign({},t.props,{__enhancements:e})})}var u=e({}),c=u.Provider,l=u.Consumer,d=function(e){function n(r){var n=this;e.call(this,r),this.nextStep=function(){n.state.currentStep+1>=n.numberOfSteps||n.setState(function(t){return Object.assign({},t,{currentStep:t.currentStep+1})})},this.prevStep=function(){n.state.currentStep-1<0||n.setState(function(t){return Object.assign({},t,{currentStep:t.currentStep-1})})},this.onboardingRenderer=function(){var e=n.props,r=e.finished,s=n.state.currentStep,i=0,a=!1;return t.map(e.children,function(t,e){if(t){var u,c=t.type.__type;if(!c)return t;if(r||c!==p)return r||c===p||c===o?r||c!==o?r&&c!==o?t:void 0:i!==s||a?void(i+=1):(a=!0,(u=t).type.__type!==o?u:Object.assign({},u,{key:u.props.name,props:Object.assign({},u.props,{__enhancements:{nextStep:n.nextStep,prevStep:n.prevStep}})})):t}})},this.state={initialStep:r.initialStep||0,currentStep:r.initialStep||0},this.numberOfSteps=t.map(r.children,function(t){if(t.type.__type===o)return t}).length,console.log(this.numberOfSteps)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.shouldComponentUpdate=function(t,e){return this.state.currentStep!==e.currentStep||this.props.finished!==t.finished},n.prototype.render=function(){return r(c,{value:{numberOfSteps:this.numberOfSteps,currentStep:this.state.currentStep+1,onboarding:s.tree,prevStep:this.prevStep,nextStep:this.nextStep}},this.onboardingRenderer())},n}(n);function h(t){return t.replace(/-/gi,"_")}var f=function(t){function e(e){var r=this;t.call(this,e),this.setValidStep=function(t){return r.setState({validStep:t})},this.setProcessed=function(t){return r.setState({processed:t})},this.stepRenderer=function(){var t=r.props,e=t.name,n=t.__enhancements,s=r.state,o=s.processed,i=(0,t.children)({nextStep:o?n.nextStep:function(){return null},prevStep:n.prevStep||function(){return null},validStep:!(!s.validStep||!o)});return Array.isArray(i.props.children)?Object.assign({},i,{props:{children:i.props.children.map(function(t){return a(t,{step:h(e),setValidStep:r.setValidStep,setProcessed:r.setProcessed})})}}):Object.assign({},i,{props:{children:a(i.props.children,{step:h(e),setValidStep:r.setValidStep,setProcessed:r.setProcessed})}})};var n=h(e.name);s.setStep(n),this.state={validStep:!0,processed:!!e.conversational}}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.componentDidMount=function(){this.props.children({nextStep:function(){},prevStep:function(){},validStep:!0}).props.children.some(function(t){return t.props.validations})||this.setState({processed:!0})},e.prototype.render=function(){return this.stepRenderer()},e}(n);f.__type=o;var v=function(t){function e(e){var r=this;t.call(this,e),this.onChange=function(t){r.setState(function(){return{valid:!0,error:null}},function(){var e=r.props.__enhancements.setProcessed;s.setFieldValue(r.snaked_name,r.step,t),r.setState({value:t});var n=r.props.validations;if(void 0===n&&(n=[]),0!==n.length){var o=n.filter(function(t){return"change"===t.on});if(o)for(var i=!1,p=0;p<o.length&&!i;p++){var a=r.props.__enhancements.setValidStep,u=o[p].validator(t);u||(r.setState({valid:!1,error:o[p].errorMessage}),i=!0),a(u)}}e(!0)})},this.onFocus=function(){r.setState(function(){return{valid:!0,error:null}},function(){var t=r.state.value,e=r.props.validations;if(void 0===e&&(e=[]),0!==e.length){var n=e.filter(function(t){return"focus"===t.on});if(n)for(var s=!1,o=0;o<n.length&&!s;o++){var i=r.props.__enhancements.setValidStep,p=n[o].validator(t);p||(r.setState({valid:!1,error:n[o].errorMessage}),s=!0),i(p)}}})},this.onBlur=function(){r.setState(function(){return{valid:!0,error:null}},function(){var t=r.state.value,e=r.props.validations;if(void 0===e&&(e=[]),0!==e.length){var n=e.filter(function(t){return"blur"===t.on});if(n)for(var s=!1,o=0;o<n.length&&!s;o++){var i=r.props.__enhancements.setValidStep,p=n[o].validator(t);p||(r.setState({valid:!1,error:n[o].errorMessage}),s=!0),i(p)}}})};var n=this.props.__enhancements.step;this.snaked_name=h(e.name),this.step=n,s.setField(this.snaked_name,n),this.state={value:s.getFieldValue(this.snaked_name,n),valid:!0,error:null}}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.render=function(){var t=this.props,e=this.state;return(0,t.children)({value:e.value,type:t.type,onChange:this.onChange,onBlur:this.onBlur,onFocus:this.onFocus,error:e.error,valid:e.valid})},e}(n);v.__type=i;var S=function(t){function e(){t.apply(this,arguments),this.state={tree:Object.assign({},s.tree)}}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.render=function(){return(0,this.props.children)(this.state.tree)},e}(n);S.__type=p;export{d as Onboarding,l as Info,f as Step,v as Field,S as End};
//# sourceMappingURL=react-onboarding.mjs.js.map
