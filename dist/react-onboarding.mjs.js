import{Children as e,createContext as t,createElement as n,Component as r}from"react";var i=function(){var e={};function t(t){e[t]||(e[t]={})}return{tree:e,setStep:t,setField:function(n,r){void 0===e[r]&&t(r),e[r][n]||(e[r][n]="")},setFieldValue:function(t,n,r){void 0!==e[n]&&void 0!==e[n][t]&&(e[n][t]=r)},getFieldValue:function(t,n){return void 0===e[n]||void 0===e[n][t]?"":e[n][t]}}}(),o="STEP",s="FIELD",a="END",p=t({}),u=p.Provider,c=p.Consumer,l=function(t){function r(n){var r=this;t.call(this,n),this.nextStep=function(){r.state.currentStep+1>=r.numberOfSteps||r.setState(function(e){return Object.assign({},e,{currentStep:e.currentStep+1})})},this.prevStep=function(){r.state.currentStep-1<0||r.setState(function(e){return Object.assign({},e,{currentStep:e.currentStep-1})})},this.finishForm=function(){r.setState({finished:!0})},this.onboardingRenderer=function(){var t=r.state,n=t.currentStep,i=t.finished,s=0,p=!1,u=[];return e.map(r.props.children,function(e){if(e){var t=e.type.__type;if(!i&&!t)return e;if(i||t!==a){if(!i&&t!==a&&t!==o)return e;if(!i&&t===o){if(u.includes(e.props.name))throw new Error("You have defined a duplicated step. "+e.props.name+" step has already been defined.");return u=u.concat([e.props.name]),s!==n||p?void(s+=1):(p=!0,(c=e).type.__type!==o?c:Object.assign({},c,{key:c.props.name,props:Object.assign({},c.props,{__enhancements:{nextStep:r.nextStep,prevStep:r.prevStep,finish:r.finishForm}})}))}var c;if(!i||t===a)return i&&t===a?e:void 0}}})},this.state={initialStep:n.initialStep||0,currentStep:n.initialStep||0,finished:!1},this.numberOfSteps=e.map(n.children,function(e){if(e.type.__type===o)return e}).length}return t&&(r.__proto__=t),(r.prototype=Object.create(t&&t.prototype)).constructor=r,r.prototype.shouldComponentUpdate=function(e,t){var n=this.state;return n.currentStep!==t.currentStep||n.finished!==t.finished},r.prototype.render=function(){return n(u,{value:{numberOfSteps:this.numberOfSteps,currentStep:this.state.currentStep+1,onboarding:i.tree,prevStep:this.prevStep,nextStep:this.nextStep,finish:this.finishForm}},this.onboardingRenderer())},r}(r);function f(e){return e.replace(/-/gi,"_")}var d=function(t){function n(n){var r=this;t.call(this,n),this.setValidStep=function(e){return r.setState({validStep:e})},this.setProcessed=function(e){return r.setState({processed:e})},this.stepRenderer=function(){var t=r.props,n=t.name,i=t.__enhancements,o=r.state,a=o.processed,p=(0,t.children)({nextStep:a?i.nextStep:function(){return null},prevStep:i.prevStep||function(){return null},finish:a?i.finish:function(){return null},validStep:o.validStep});return Object.assign({},p,{props:{children:e.map(p.props.children,function(e){var t,i;if(e)return e.type.__type===s?(t=e,i={step:f(n),setValidStep:r.setValidStep,setProcessed:r.setProcessed},t.type.__type!==s?t:Object.assign({},t,{key:t.props.name,props:Object.assign({},t.props,{__enhancements:i})})):e})}})};var o=f(n.name);n.conversational||i.setStep(o),this.state={validStep:!0,processed:!!n.conversational}}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.componentDidMount=function(){this.props.children({nextStep:function(){},prevStep:function(){},finish:function(){},validStep:!0}).props.children.some(function(e){return e.props.validations})||this.setState({processed:!0})},n.prototype.render=function(){return this.stepRenderer()},n}(r);d.__type=o;var h=function(e){function t(t){var n=this;e.call(this,t),this.onChange=function(e){return new Promise(function(t){n.setState(function(){return{valid:!0,error:null}},function(){var r=n.props.__enhancements.setProcessed;i.setFieldValue(n.snaked_name,n.step,e),n.setState({value:e});var o=n.props.validations;if(void 0===o&&(o=[]),0!==o.length){var s=o.filter(function(e){return"change"===e.on});if(s)for(var a=!1,p=0;p<s.length&&!a;p++){var u=n.props.__enhancements.setValidStep,c=s[p].validator(e);c||(n.setState({valid:!1,error:s[p].errorMessage}),a=!0),u(c),t()}}r(!0),t()})})},this.onFocus=function(){return new Promise(function(e){n.setState(function(){return{valid:!0,error:null}},function(){var t=n.state.value,r=n.props.validations;if(void 0===r&&(r=[]),0!==r.length){var i=r.filter(function(e){return"focus"===e.on});if(i)for(var o=!1,s=0;s<i.length&&!o;s++){var a=n.props.__enhancements.setValidStep,p=i[s].validator(t);p||(n.setState({valid:!1,error:i[s].errorMessage}),o=!0),a(p),e()}}e()})})},this.onBlur=function(){return new Promise(function(e){n.setState(function(){return{valid:!0,error:null}},function(){var t=n.state.value,r=n.props.validations;if(void 0===r&&(r=[]),0!==r.length){var i=r.filter(function(e){return"blur"===e.on});if(i)for(var o=!1,s=0;s<i.length&&!o;s++){var a=n.props.__enhancements.setValidStep,p=i[s].validator(t);p||(n.setState({valid:!1,error:i[s].errorMessage}),o=!0),a(p),e()}}e()})})},this.onEnter=function(e){var t=n,r=n.props.validations;if(void 0===r&&(r=[]),0===r.length)n.state.valid&&void 0!==e&&e();else{var i=r.find(function(e){return"enter"===e.on});i&&i.validations.forEach(function(n){try{function i(){function n(){function n(){t.state.valid&&void 0!==e&&e()}var r=function(){if("blur"===o.on)return Promise.resolve(t.onBlur()).then(function(){})}();return r&&r.then?r.then(n):n()}var r=function(){if("change"===o.on)return Promise.resolve(t.onChange(t.state.value)).then(function(){})}();return r&&r.then?r.then(n):n()}var o=r.find(function(e){return e.name===n});if(!o)return console.error("Validation "+n+" not found. Check validations prop to make sure you've included it."),Promise.resolve();var s=function(){if("focus"===o.on)return Promise.resolve(t.onFocus()).then(function(){})}();return Promise.resolve(s&&s.then?s.then(i):i())}catch(e){return Promise.reject(e)}})}};var r=this.props,o=r.validations,s=r.__enhancements.step;this.snaked_name=f(t.name),this.step=s,i.setField(this.snaked_name,s),this.state={value:i.getFieldValue(this.snaked_name,s),valid:!0,error:null},o&&0!==o.length&&function(e){return e.filter(function(e){return"enter"===e.on}).length>1}(o)&&console.warn('You have defined various "enter" validations for the "'+t.name+'" field. Only the first occurrence will be used, the rest will be discarted')}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.render=function(){var e=this.props,t=this.state;return(0,e.children)({value:t.value,type:e.type,onChange:this.onChange,onBlur:this.onBlur,onFocus:this.onFocus,onEnter:this.onEnter,error:t.error,valid:t.valid})},t}(r);h.__type=s;var v=function(e){function t(){e.apply(this,arguments),this.state={tree:Object.assign({},i.tree)}}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.render=function(){return(0,this.props.children)(this.state.tree)},t}(r);v.__type=a;export{l as Onboarding,c as Info,d as Step,h as Field,v as End};
//# sourceMappingURL=react-onboarding.mjs.js.map
