var e=require("react"),t=function(){var e={};function t(t){e[t]||(e[t]={})}return{tree:e,setStep:t,setField:function(n,r){void 0===e[r]&&t(r),e[r][n]||(e[r][n]="")},setFieldValue:function(t,n,r){void 0!==e[n]&&void 0!==e[n][t]&&(e[n][t]=r)},getFieldValue:function(t,n){return void 0===e[n]||void 0===e[n][t]?"":e[n][t]}}}(),n="STEP",r="FIELD",i="END",o=e.createContext({}),s=o.Provider,a=o.Consumer,p=function(r){function o(t){var o=this;r.call(this,t),this.nextStep=function(){o.state.currentStep+1>=o.numberOfSteps||o.setState(function(e){return Object.assign({},e,{currentStep:e.currentStep+1})})},this.prevStep=function(){o.state.currentStep-1<0||o.setState(function(e){return Object.assign({},e,{currentStep:e.currentStep-1})})},this.finishForm=function(){o.setState({finished:!0})},this.onboardingRenderer=function(){var t=o.state,r=t.currentStep,s=t.finished,a=0,p=!1,u=[];return e.Children.map(o.props.children,function(e){if(e){var t=e.type.__type;if(!s&&!t)return e;if(s||t!==i){if(!s&&t!==i&&t!==n)return e;if(!s&&t===n){if(u.includes(e.props.name))throw new Error("You have defined a duplicated step. "+e.props.name+" step has already been defined.");return u=u.concat([e.props.name]),a!==r||p?void(a+=1):(p=!0,(c=e).type.__type!==n?c:Object.assign({},c,{key:c.props.name,props:Object.assign({},c.props,{__enhancements:{nextStep:o.nextStep,prevStep:o.prevStep,finish:o.finishForm}})}))}var c;if(!s||t===i)return s&&t===i?e:void 0}}})},this.state={initialStep:t.initialStep||0,currentStep:t.initialStep||0,finished:!1},this.numberOfSteps=e.Children.map(t.children,function(e){if(e.type.__type===n)return e}).length}return r&&(o.__proto__=r),(o.prototype=Object.create(r&&r.prototype)).constructor=o,o.prototype.shouldComponentUpdate=function(e,t){var n=this.state;return n.currentStep!==t.currentStep||n.finished!==t.finished},o.prototype.render=function(){return e.createElement(s,{value:{numberOfSteps:this.numberOfSteps,currentStep:this.state.currentStep+1,onboarding:t.tree,prevStep:this.prevStep,nextStep:this.nextStep,finish:this.finishForm}},this.onboardingRenderer())},o}(e.Component);function u(e){return e.replace(/-/gi,"_")}var c=function(n){function i(i){var o=this;n.call(this,i),this.setValidStep=function(e){return o.setState({validStep:e})},this.setProcessed=function(e){return o.setState({processed:e})},this.stepRenderer=function(){var t=o.props,n=t.name,i=t.__enhancements,s=o.state,a=s.processed,p=(0,t.children)({nextStep:a?i.nextStep:function(){return null},prevStep:i.prevStep||function(){return null},finish:a?i.finish:function(){return null},validStep:s.validStep});return Object.assign({},p,{props:{children:e.Children.map(p.props.children,function(e){var t,i;if(e)return e.type.__type===r?(t=e,i={step:u(n),setValidStep:o.setValidStep,setProcessed:o.setProcessed},t.type.__type!==r?t:Object.assign({},t,{key:t.props.name,props:Object.assign({},t.props,{__enhancements:i})})):e})}})};var s=u(i.name);i.conversational||t.setStep(s),this.state={validStep:!0,processed:!!i.conversational}}return n&&(i.__proto__=n),(i.prototype=Object.create(n&&n.prototype)).constructor=i,i.prototype.componentDidMount=function(){this.props.children({nextStep:function(){},prevStep:function(){},finish:function(){},validStep:!0}).props.children.some(function(e){return e.props.validations})||this.setState({processed:!0})},i.prototype.render=function(){return this.stepRenderer()},i}(e.Component);c.__type=n;var l=function(e){function n(n){var r=this;e.call(this,n),this.onChange=function(e){return new Promise(function(n){r.setState(function(){return{valid:!0,error:null}},function(){var i=r.props.__enhancements.setProcessed;t.setFieldValue(r.snaked_name,r.step,e),r.setState({value:e});var o=r.props.validations;if(void 0===o&&(o=[]),0!==o.length){var s=o.filter(function(e){return"change"===e.on});if(s)for(var a=!1,p=0;p<s.length&&!a;p++){var u=r.props.__enhancements.setValidStep,c=s[p].validator(e);c||(r.setState({valid:!1,error:s[p].errorMessage}),a=!0),u(c),n()}}i(!0),n()})})},this.onFocus=function(){return new Promise(function(e){r.setState(function(){return{valid:!0,error:null}},function(){var t=r.state.value,n=r.props.validations;if(void 0===n&&(n=[]),0!==n.length){var i=n.filter(function(e){return"focus"===e.on});if(i)for(var o=!1,s=0;s<i.length&&!o;s++){var a=r.props.__enhancements.setValidStep,p=i[s].validator(t);p||(r.setState({valid:!1,error:i[s].errorMessage}),o=!0),a(p),e()}}e()})})},this.onBlur=function(){return new Promise(function(e){r.setState(function(){return{valid:!0,error:null}},function(){var t=r.state.value,n=r.props.validations;if(void 0===n&&(n=[]),0!==n.length){var i=n.filter(function(e){return"blur"===e.on});if(i)for(var o=!1,s=0;s<i.length&&!o;s++){var a=r.props.__enhancements.setValidStep,p=i[s].validator(t);p||(r.setState({valid:!1,error:i[s].errorMessage}),o=!0),a(p),e()}}e()})})},this.onEnter=function(e){var t=r,n=r.props.validations;if(void 0===n&&(n=[]),0===n.length)r.state.valid&&void 0!==e&&e();else{var i=n.find(function(e){return"enter"===e.on});i&&i.validations.forEach(function(r){try{function i(){function n(){function n(){t.state.valid&&void 0!==e&&e()}var r=function(){if("blur"===o.on)return Promise.resolve(t.onBlur()).then(function(){})}();return r&&r.then?r.then(n):n()}var r=function(){if("change"===o.on)return Promise.resolve(t.onChange(t.state.value)).then(function(){})}();return r&&r.then?r.then(n):n()}var o=n.find(function(e){return e.name===r});if(!o)return console.error("Validation "+r+" not found. Check validations prop to make sure you've included it."),Promise.resolve();var s=function(){if("focus"===o.on)return Promise.resolve(t.onFocus()).then(function(){})}();return Promise.resolve(s&&s.then?s.then(i):i())}catch(e){return Promise.reject(e)}})}};var i=this.props,o=i.validations,s=i.__enhancements.step;this.snaked_name=u(n.name),this.step=s,t.setField(this.snaked_name,s),this.state={value:t.getFieldValue(this.snaked_name,s),valid:!0,error:null},o&&0!==o.length&&function(e){return e.filter(function(e){return"enter"===e.on}).length>1}(o)&&console.warn('You have defined various "enter" validations for the "'+n.name+'" field. Only the first occurrence will be used, the rest will be discarted')}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.render=function(){var e=this.props,t=this.state;return(0,e.children)({value:t.value,type:e.type,onChange:this.onChange,onBlur:this.onBlur,onFocus:this.onFocus,onEnter:this.onEnter,error:t.error,valid:t.valid})},n}(e.Component);l.__type=r;var f=function(e){function n(){e.apply(this,arguments),this.state={tree:Object.assign({},t.tree)}}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.render=function(){return(0,this.props.children)(this.state.tree)},n}(e.Component);f.__type=i,exports.Onboarding=p,exports.Info=a,exports.Step=c,exports.Field=l,exports.End=f;
//# sourceMappingURL=react-onboarding.js.map
