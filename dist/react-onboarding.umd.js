!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],t):t(e.onboarding={},e.react)}(this,function(e,t){var n=function(){var e={};function t(t){e[t]||(e[t]={})}return{tree:e,setStep:t,setField:function(n,r){void 0===e[r]&&t(r),e[r][n]||(e[r][n]="")},setFieldValue:function(t,n,r){void 0!==e[n]&&void 0!==e[n][t]&&(e[n][t]=r)},getFieldValue:function(t,n){return void 0===e[n]||void 0===e[n][t]?"":e[n][t]}}}(),r="STEP",i="FIELD",o="END",s=t.createContext({}),a=s.Provider,p=s.Consumer,u=function(e){function i(n){var i=this;e.call(this,n),this.nextStep=function(){i.state.currentStep+1>=i.numberOfSteps||i.setState(function(e){return Object.assign({},e,{currentStep:e.currentStep+1})})},this.prevStep=function(){i.state.currentStep-1<0||i.setState(function(e){return Object.assign({},e,{currentStep:e.currentStep-1})})},this.finishForm=function(){i.setState({finished:!0})},this.onboardingRenderer=function(){var e=i.state,n=e.currentStep,s=e.finished,a=0,p=!1,u=[];return t.Children.map(i.props.children,function(e){if(e){var t=e.type.__type;if(!s&&!t)return e;if(s||t!==o){if(!s&&t!==o&&t!==r)return e;if(!s&&t===r){if(u.includes(e.props.name))throw new Error("You have defined a duplicated step. "+e.props.name+" step has already been defined.");return u=u.concat([e.props.name]),a!==n||p?void(a+=1):(p=!0,(c=e).type.__type!==r?c:Object.assign({},c,{key:c.props.name,props:Object.assign({},c.props,{__enhancements:{nextStep:i.nextStep,prevStep:i.prevStep,finish:i.finishForm}})}))}var c;if(!s||t===o)return s&&t===o?e:void 0}}})},this.state={initialStep:n.initialStep||0,currentStep:n.initialStep||0,finished:!1},this.numberOfSteps=t.Children.map(n.children,function(e){if(e.type.__type===r)return e}).length}return e&&(i.__proto__=e),(i.prototype=Object.create(e&&e.prototype)).constructor=i,i.prototype.shouldComponentUpdate=function(e,t){var n=this.state;return n.currentStep!==t.currentStep||n.finished!==t.finished},i.prototype.render=function(){return t.createElement(a,{value:{numberOfSteps:this.numberOfSteps,currentStep:this.state.currentStep+1,onboarding:n.tree,prevStep:this.prevStep,nextStep:this.nextStep,finish:this.finishForm}},this.onboardingRenderer())},i}(t.Component);function c(e){return e.replace(/-/gi,"_")}var f=function(e){function r(r){var o=this;e.call(this,r),this.setValidStep=function(e){return o.setState({validStep:e})},this.setProcessed=function(e){return o.setState({processed:e})},this.stepRenderer=function(){var e=o.props,n=e.name,r=e.__enhancements,s=o.state,a=s.processed,p=(0,e.children)({nextStep:a?r.nextStep:function(){return null},prevStep:r.prevStep||function(){return null},finish:a?r.finish:function(){return null},validStep:s.validStep});return Object.assign({},p,{props:{children:t.Children.map(p.props.children,function(e){var t,r;if(e)return e.type.__type===i?(t=e,r={step:c(n),setValidStep:o.setValidStep,setProcessed:o.setProcessed},t.type.__type!==i?t:Object.assign({},t,{key:t.props.name,props:Object.assign({},t.props,{__enhancements:r})})):e})}})};var s=c(r.name);r.conversational||n.setStep(s),this.state={validStep:!0,processed:!!r.conversational}}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.componentDidMount=function(){this.props.children({nextStep:function(){},prevStep:function(){},finish:function(){},validStep:!0}).props.children.some(function(e){return e.props.validations})||this.setState({processed:!0})},r.prototype.render=function(){return this.stepRenderer()},r}(t.Component);f.__type=r;var l=function(e){function t(t){var r=this;e.call(this,t),this.onChange=function(e){return new Promise(function(t){r.setState(function(){return{valid:!0,error:null}},function(){var i=r.props.__enhancements.setProcessed;n.setFieldValue(r.snaked_name,r.step,e),r.setState({value:e});var o=r.props.validations;if(void 0===o&&(o=[]),0!==o.length){var s=o.filter(function(e){return"change"===e.on});if(s)for(var a=!1,p=0;p<s.length&&!a;p++){var u=r.props.__enhancements.setValidStep,c=s[p].validator(e);c||(r.setState({valid:!1,error:s[p].errorMessage}),a=!0),u(c),t()}}i(!0),t()})})},this.onFocus=function(){return new Promise(function(e){r.setState(function(){return{valid:!0,error:null}},function(){var t=r.state.value,n=r.props.validations;if(void 0===n&&(n=[]),0!==n.length){var i=n.filter(function(e){return"focus"===e.on});if(i)for(var o=!1,s=0;s<i.length&&!o;s++){var a=r.props.__enhancements.setValidStep,p=i[s].validator(t);p||(r.setState({valid:!1,error:i[s].errorMessage}),o=!0),a(p),e()}}e()})})},this.onBlur=function(){return new Promise(function(e){r.setState(function(){return{valid:!0,error:null}},function(){var t=r.state.value,n=r.props.validations;if(void 0===n&&(n=[]),0!==n.length){var i=n.filter(function(e){return"blur"===e.on});if(i)for(var o=!1,s=0;s<i.length&&!o;s++){var a=r.props.__enhancements.setValidStep,p=i[s].validator(t);p||(r.setState({valid:!1,error:i[s].errorMessage}),o=!0),a(p),e()}}e()})})},this.onEnter=function(e){var t=r,n=r.props.validations;if(void 0===n&&(n=[]),0===n.length)r.state.valid&&void 0!==e&&e();else{var i=n.find(function(e){return"enter"===e.on});i&&i.validations.forEach(function(r){try{function i(){function n(){function n(){t.state.valid&&void 0!==e&&e()}var r=function(){if("blur"===o.on)return Promise.resolve(t.onBlur()).then(function(){})}();return r&&r.then?r.then(n):n()}var r=function(){if("change"===o.on)return Promise.resolve(t.onChange(t.state.value)).then(function(){})}();return r&&r.then?r.then(n):n()}var o=n.find(function(e){return e.name===r});if(!o)return console.error("Validation "+r+" not found. Check validations prop to make sure you've included it."),Promise.resolve();var s=function(){if("focus"===o.on)return Promise.resolve(t.onFocus()).then(function(){})}();return Promise.resolve(s&&s.then?s.then(i):i())}catch(e){return Promise.reject(e)}})}};var i=this.props,o=i.validations,s=i.__enhancements.step;this.snaked_name=c(t.name),this.step=s,n.setField(this.snaked_name,s),this.state={value:n.getFieldValue(this.snaked_name,s),valid:!0,error:null},o&&0!==o.length&&function(e){return e.filter(function(e){return"enter"===e.on}).length>1}(o)&&console.warn('You have defined various "enter" validations for the "'+t.name+'" field. Only the first occurrence will be used, the rest will be discarted')}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.render=function(){var e=this.props,t=this.state;return(0,e.children)({value:t.value,type:e.type,onChange:this.onChange,onBlur:this.onBlur,onFocus:this.onFocus,onEnter:this.onEnter,error:t.error,valid:t.valid})},t}(t.Component);l.__type=i;var d=function(e){function t(){e.apply(this,arguments),this.state={tree:Object.assign({},n.tree)}}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.render=function(){return(0,this.props.children)(this.state.tree)},t}(t.Component);d.__type=o,e.Onboarding=u,e.Info=p,e.Step=f,e.Field=l,e.End=d});
//# sourceMappingURL=react-onboarding.umd.js.map
